# Bug Fix Journal - Issue #6: Logic Error in Slideshow Timeout

**Date**: 2026-02-15  
**Issue**: #6 from docs/plan.md  
**File**: `pho.c:68-69`  
**Type**: Logic error

## Problem Description

In `ShowImage()`, the slideshow timeout condition used a logically incorrect expression that was always true:

```c
if (gDelayMillis > 0 && gPendingTimeout == 0
    && (gCurImage->next != 0 || gCurImage->next != gFirstImage)) {
```

The condition `(gCurImage->next != 0 || gCurImage->next != gFirstImage)` is **ALWAYS TRUE** because a pointer cannot be both NULL (0) and equal to gFirstImage at the same time.

## Impact

- Slideshow would never stop at the end of the image list
- Timeout kept being added even for the last image
- Slideshow would loop indefinitely (unless `-r` repeat flag was used)

## Root Cause Analysis

The intent was to check: "Is there a next image to show?"

The buggy logic:
- If `next != 0` → TRUE (there's a next image)
- If `next != gFirstImage` → TRUE (not at end of circular list)
- With `||`: Always true because both can't be false simultaneously

Correct logic should be:
- `next != 0` AND `next != gFirstImage`
- Only true when there's actually a valid next image

## Fix Applied

Changed `||` to `&&`:

```diff
  if (gDelayMillis > 0 && gPendingTimeout == 0
-     && (gCurImage->next != 0 || gCurImage->next != gFirstImage)) {
+     && (gCurImage->next != 0 && gCurImage->next != gFirstImage)) {
```

## Testing

### Regression Test Results
```
$ ./regression/test_issue_6

test_slideshow_timeout_not_added_at_end_single_image:PASS
test_slideshow_timeout_added_in_middle:PASS
test_slideshow_timeout_not_added_at_end_last_image:PASS
test_slideshow_timeout_added_at_first:PASS
test_slideshow_no_timeout_if_no_delay:PASS
test_slideshow_no_timeout_if_pending:PASS

6 Tests 0 Failures 0 Ignored - OK
```

### Test Coverage
- Single image list (next points to itself) - no timeout at end
- Multiple images in middle - timeout added
- Last image in list - no timeout at end
- First image - timeout added
- Slideshow disabled (delay = 0) - no timeout
- Timeout already pending - no duplicate timeout

## Verification

1. ✅ All regression tests pass
2. ✅ Main binary compiles without errors
3. ✅ Fix is minimal (1 character change)
4. ✅ Logic now correctly detects end of list

## Lessons Learned

1. **Boolean algebra matters**: `||` vs `&&` completely changes logic
2. **De Morgan's laws**: The original was trying to express "not (next == 0 && next == gFirstImage)" incorrectly
3. **Always test edge cases**: Single image, last image, empty list
4. **Simple bugs can have big impact**: One character prevented slideshow from stopping

## The Bug in Plain English

**Before**: "Add timeout if there's a next image OR if we're not at the first image"
- Result: Always true (can't be both NULL and first at once)

**After**: "Add timeout if there's a next image AND we're not back at the start"
- Result: Only true when there's actually another image to show
